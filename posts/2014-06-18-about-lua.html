<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>All you need is love and little bit of LSD - Немного о лунном.</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="container">
            <div id="header">
                <div id="logo">
                    <a href="../">All you need is love and a little bit of LSD</a>
                </div>
                <div id="navigation">
                    <a href="../about.html">About</a>
                    <a href="../contact.html">Contact</a>
                    <a href="../archive.html">Archive</a>
                </div>
            </div>

            <div id="content">
                <h1>Немного о лунном.</h1>
                <div class="info">
    Posted on June 18, 2014 with tags: <a href="../tags/lua.html">lua</a>.
</div>

<p>Лунный примечателен тем что это очень простой язык. Несмотря на такие языковые возможности как анонимные функции и замыкания это очень традиционный процедурный язык. Языковые конструкции в нём означают примерно то чего от них и ждёшь. Его простота столь велика что определённым образом провоцирует беспечность программиста. В следствие этой беспечности столкновения с тёмными сторонами языка обычно бывают особенно болезненны и полны детской обиды (учить язык?). Здесь перечислено несколько моментов, столкновение с которыми у нормального программиста может вызвать недоумение<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>:</p>
<ol>
<li><p>Массивы индексируются начиная с единицы<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>.</p>
<pre class="sourceCode lua"><code class="sourceCode lua">v <span class="ot">=</span> <span class="ot">{</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span> <span class="ot">}</span>

<span class="kw">for</span> i <span class="ot">=</span> <span class="dv">0</span><span class="ot">,</span> <span class="ot">#</span>v <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span> v<span class="ot">[</span>i<span class="ot">]</span> <span class="ot">)</span>
<span class="kw">end</span>

<span class="co">-- nil</span>
<span class="co">-- 0</span>
<span class="co">-- 1</span>
<span class="co">-- 2</span>
<span class="co">-- 3</span></code></pre></li>
<li><p>Язык в целом передаёт все значения по ссылке. Так, например, переменные захватываются в замыкания именно по ссылке и позволяют модифицировать глобальные переменные из контекста замыкания. Но при передаче значения в функцию в качестве аргумента создаётся <strong>новая локальная ссылка</strong> и изменения переменной во внешнем скоупе происходить не будет<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>.</p>
<pre class="sourceCode lua"><code class="sourceCode lua">x <span class="ot">=</span> <span class="dv">1</span>
y <span class="ot">=</span> <span class="dv">13</span>

z <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span> v <span class="ot">)</span>
    v <span class="ot">=</span> <span class="dv">0</span>
    y <span class="ot">=</span> <span class="dv">0</span>
<span class="kw">end</span>

<span class="fu">print</span><span class="ot">(</span> x<span class="ot">,</span> y <span class="ot">)</span>
z<span class="ot">(</span> x <span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span> x<span class="ot">,</span> y <span class="ot">)</span>

<span class="co">-- 1    13</span>
<span class="co">-- 1    0</span></code></pre></li>
<li><p>Если инициализировать локальную переменную анонимной функцией, то она не будет доступна внутри области видимости анонимной функции. Таким образом мы вполне можем вызывать такую функцию рекурсивно.</p>
<pre class="sourceCode lua"><code class="sourceCode lua">f <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span> x <span class="ot">)</span>
    f<span class="ot">(</span> x <span class="ot">)</span>
<span class="kw">end</span>

<span class="co">-- Всё в порядке. Путь к переполнению стека открыт.</span>

<span class="kw">local</span> f1 <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span> x <span class="ot">)</span>
    f1<span class="ot">(</span> x <span class="ot">)</span>
<span class="kw">end</span>

<span class="co">-- Всё плохо.</span>

<span class="kw">local</span> f2
f2 <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span> x <span class="ot">)</span>
    f2<span class="ot">(</span> x <span class="ot">)</span>
<span class="kw">end</span>

<span class="co">-- А вот так, как не странно, всё хорошо.</span></code></pre></li>
<li><p>В lua свои собственные особенные регулярные выражения. Само по себе это не редкость.</p></li>
<li><p>Знак неравенства.</p></li>
<li><p>Форматированный вывод?</p></li>
</ol>
<p>Также если вы кондовый сишник, вам безусловно очень понравятся begin и end, но это уже совсем другая история.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Важно понимать, что никакой тайны из этих вещей не делается. Наоборот, все эти вещи описаны в официальной документации к языку. Она у него кстати довольно короткая. Просто все её читают в лучшем случае по диагонали.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Читать <a href="http://www.lua.org/manual/5.2/manual.html#2.1">здесь</a> где-то начиная с «We use the term sequence…».<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Читать <a href="http://www.lua.org/manual/5.2/manual.html#3.2">здесь</a> начиная с «…function’s formal parameter…».<a href="#fnref3">↩</a></p></li>
</ol>
</div>

            </div>
            <div id="footer-push"></div>
        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
